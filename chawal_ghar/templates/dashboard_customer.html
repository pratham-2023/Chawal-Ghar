{% extends "layout.html" %}

{% block content %}
<h2>Customer Dashboard</h2>
<p>Welcome, {{ session['fullname'] }}!</p>

<div style="margin-top: 40px;">
    <h3>üçö Premium Rice Varieties Available</h3>
    <p style="color: #666; margin-bottom: 20px;">Browse our selection of rice directly from local farmers</p>

    {% if products %}
    <div class="rice-grid">
        {% for product in products %}
        {% set rice_type = product['p_type']|lower %}
        {% set image_map = {
        'basmati': 'basmati.png',
        'kolam': 'kolam.png',
        'sona masoori': 'sona_masoori.png',
        'jasmine': 'jasmine.png',
        'brown': 'brown.png',
        'red': 'red.png',
        'black': 'black.png',
        'ponni': 'ponni.png'
        } %}
        {% set rice_image = image_map.get(rice_type, 'basmati.png') %}

        <div class="rice-card">
            <img src="{{ url_for('static', filename='images/rice_varieties/' + rice_image) }}"
                alt="{{ product['p_type'] }} Rice" class="rice-card-image">

            <div class="rice-card-content">
                <div class="rice-card-title">{{ product['p_name'] }}</div>
                <div class="rice-card-type">{{ product['p_type'] }}</div>
                <div class="rice-card-farmer">{{ product['f_fullname'] }}</div>
                <div class="rice-card-price">‚Çπ{{ product['p_priceperunit'] }}/kg</div>

                <div class="rice-card-actions">
                    <form action="{{ url_for('add_to_cart', p_id=product['p_id']) }}" method="POST">
                        <input type="number" name="quantity" value="1" min="1" max="{{ product['p_quantity'] }}">
                        <button type="submit" class="btn btn-cart">üõí Add to Cart</button>
                    </form>
                    <a href="{{ url_for('buy_product', p_id=product['p_id']) }}" class="btn btn-buy-now">‚ö° Buy Now</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p><i>No rice available currently.</i></p>
    {% endif %}
</div>

<div style="margin-top: 60px;">
    <h3>üìú My Orders</h3>
    {% if my_orders %}
    <table>
        <thead>
            <tr>
                <th>Order ID</th>
                <th>Rice</th>
                <th>Date</th>
                <th>Destination</th>
                <th>Amount</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for order in my_orders %}
            <tr>
                <td>#{{ order['o_id'] }}</td>
                <td>{{ order['p_name'] }}</td>
                <td>{{ order['o_date'] }}</td>
                <td>{{ order['o_destination'] }}</td>
                <td>‚Çπ{{ order['o_amount'] }}</td>
                <td>{{ order['o_status'] }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p><i>No orders placed yet.</i></p>
    {% endif %}
</div>
{% endblock %}